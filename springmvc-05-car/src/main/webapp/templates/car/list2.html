<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<link th:href="@{/static/bootstrap/css/bootstrap.min.css}"
	rel="stylesheet">
<title>车辆列表</title>
		<style type="text/css">
			.carPage{
				text-align:center;
			}
		</style>
	</head>
	<body>
		<h2>车辆列表</h2>
		
			
		<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
		  <div class="panel panel-default">
		    <div class="panel-heading" role="tab" id="headingOne">
		      <h4 class="panel-title">
		        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
		         	 查询
		        </a>
		      </h4>
		    </div>
		    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
		      <form>
		      	<div class="panel-body" id="brand" ></div>
		      
		      <div class="panel-body" id="series"></div>
		      </form>
		    </div>
		  </div>
		</div>
		
	  <div class="form-group">
	    <label for="level" class="col-sm-2 control-label">级别</label>
	    <div class="col-sm-3 input-group">
	      <select class="form-control" name="level" id="level">
	      	<option value=''>--请选择--</option>
	      </select>
	    </div>
	  </div>
	  
	 
	  <div class="form-group">
	    <label for="gearbox" class="col-sm-2 control-label">变数箱</label>
	    <div class="col-sm-3 input-group" id="gearbox">
	      <select class="form-control" name="gearbox" id="gearbox">
	      	<option value=''>--请选择--</option>
	      </select>
	    </div>
	  </div>
	  
	  
	  <div class="form-group">
	    <label for="outputVolume" class="col-sm-2 control-label">排量</label>
	    <div class="col-sm-3 input-group">
	      <select class="form-control" name="outputVolume" id="output_volume">
	      	<option value=''>--请选择--</option>
	      </select>
	    </div>
	  </div>		
		
		
		
		
		
		<div class="container-fluid">
			<div class="row" id="carList">
			
			</div>
		</div>
		<div class="carPage" >
			<button id="firstPage" class="btn btn-primary" type="button">首页</button>
			<button id="prePage" class="btn btn-success" type="button">上一页</button>
			<button id="nextPage" class="btn btn-info" type="button">下一页</button>
			<button id="lastPage" class="btn btn-danger" type="button">尾页</button>
		</div>
		
	
	
	
<script th:src="@{/static/js/jquery/jquery-3.4.1.js}" type="text/javascript"></script>
<script th:src="@{/static/bootstrap/js/bootstrap.min.js}" type="text/javascript"></script>
<script th:inline="javascript" type="text/javascript"> 
	const path = /*[[${#request.getContextPath()}]]*/ 
	
	let currentPage = 1;
	let pageCount = '';
	
	$(function(){
		et1911.queryList();
		
		et1911.getAllBrand();
		et1911.queryAllSeries();
		
		
		
		
		
		//et1911.querySelectDict('level');
		//et1911.querySelectDict('gearbox');
		//et1911.querySelectDict('output_volume');
		
		
		$('#firstPage').click(function(){
			et1911.queryList();
		});
		$('#prePage').click(function(){
			et1911.queryList(--currentPage);
		});
		$('#nextPage').click(function(){
			et1911.queryList(++currentPage);
		});
		$('#lastPage').click(function(){
			et1911.queryList(pageCount);
		});
		
	});
	
	
	
	let et1911={
		
		queryList:function(pageNum,pageSize,brand){
			pageNum = pageNum || 1
			pageSize = pageSize || 8
			
			let brand = $('input[name="brand"]:checked').val()|| '';
			
			$.ajax({
				url:path+'/car/list',
				type:'GET',
				data:'pageNum='+pageNum+'&pageSize='+pageSize
					 +'&brand='+brand,
				dataType:'json',
				success:function(res){
					currentPage = res.pageNum;
					pageCount = res.pageCount;
					let divs = '';
					$.each(res.rows,function(index,car){
						divs += "<div class='col-md-3'>"
							 +"<img class='img-thumbnail' src='" + path + car.pic + "'>"
							 +"<p>"+car.brand+"/"+car.series+"</p>"
							 +"<p>"+car.price+"万元</p>"
							 +"<p>"+car.gearbox+"</p>"
							 +"</div>"
					})
					$('#carList').html(divs);
					
					if(res.first){
						$('#firstPage').attr('disabled','disabled')
						$('#prePage').attr('disabled','disabled')						
					}else{
						$('#firstPage').removeAttr('disabled')
						$('#prePage').removeAttr('disabled')
					}
					if(res.last){
						$('#lastPage').attr('disabled','disabled')
						$('#nextPage').attr('disabled','disabled')		
					}else{
						$('#lastPage').removeAttr('disabled')
						$('#nextPage').removeAttr('disabled')
					}
				}
			})
		},
		
		getAllBrand:function(){
			$.ajax({
				url:path + '/car/getBrand',
				type:'GET',
				data: "",
				dataType:'json',
				success:function(brand){
					let divs = ''
					$.each(brand,function(index,b){
						divs += "<input class='btn btn-default' type='button' value='" + b + "' onclick='querySeriesByBrand(this.value)' />"
					})
					$('#brand').html(divs)
				}
			})
		},
		getSeriesByBrand(value){
			$.ajax({
				url:path + '/car/getSeries',
				type:'GET',
				data: "brand="+value,
				dataType:'json',
				success:function(Series){
					let divs = ''
					$.each(Series,function(index,s){
						divs += "<input class='btn btn-default' type='button' value='" + s + "' onclick='query(this."+s+")' />"
					})
					$('#Series').html(divs)
				}
			})
		}
		
		
		
		
		
		<!--
		querySelectDict:function(groupId){
			if(groupId){
				$.ajax({
					url:path+'/car/'+groupId,
					type:'GET',
					data:'',
					dataType:'json',
					success:function(data){
						let options = "<option value='-1'>--请选择--</option>";
						for(let dict of data){
							options += "<option value='" + car.value + "'>"
									+car.name
									+"</option>"
						}
						$('#'+groupId).html(options);
					}
				})
			}
		-->
		}
	}
	
	
</script>


</body>
</html>